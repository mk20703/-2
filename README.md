# Lupang 쇼핑몰 AWS 인프라

## 프로젝트 개요

처음엔 혼자 운영하는 작은 쇼핑몰이었어요. 하루에 방문자가 1,000~2,000명 정도 되는 규모였죠.

그런데 한 달에 1~2번 정도 블랙프라이데이나 타임딜 같은 특별 이벤트를 하면, 갑자기 사람들이 몰려서 평소보다 20배 정도 트래픽이 늘어나는 거예요.

그래서 두 가지 아키텍처를 만들었습니다.

---

## 두 가지 아키텍처

### Phase 1: 평소에 사용 (3-Tier 아키텍처)

**언제 쓰나요?**
- 보통 때 (한 달에 28일 정도)
- 안정적으로 서비스를 운영할 때

**구성**
- ALB (로드밸런서) → Auto Scaling Group (서버 자동 증감) → RDS MySQL (데이터베이스)
- 서버가 2대에서 4대까지 자동으로 늘어나고 줄어듦
- Private Subnet에 서버를 두고, Bastion Host로 접속
- 이미지는 S3에 저장

**비용**
- 한 달에 약 140달러
- 서버가 계속 돌아가니까 비용이 일정함

**배포 위치**
- `phase1_ec2_rds/` 폴더

---

### Phase 2: 이벤트 때 사용 (서버리스 아키텍처)

**언제 쓰나요?**
- 블랙프라이데이, 타임딜 같은 특별 이벤트 (한 달에 2~4일)
- 갑자기 사람이 많이 몰릴 때

**구성**
- CloudFront (CDN) → S3 (정적 파일) → API Gateway → Lambda (함수) → DynamoDB (NoSQL)
- 서버 없이 요청이 올 때만 Lambda 함수가 실행됨
- 사람이 아무리 많이 와도 자동으로 처리됨

**비용**
- 사용한 만큼만 과금
- 이벤트 없으면 거의 0원
- 블랙프라이데이 주말에도 약 21달러

**배포 위치**
- 루트 폴더 (lambda.tf, api_gateway.tf, cloudfront.tf 등)

---

## 왜 이렇게 했나요?

### 만약 Phase 1만 썼다면?
블랙프라이데이 때 서버를 엄청 늘려야 해요.
→ 한 달에 276달러 나옴

### 만약 Phase 2만 썼다면?
평소에도 Lambda, DynamoDB를 쓰니까 비싸고, RDS보다 데이터 일관성이 떨어질 수 있어요.

### 두 개를 섞으면?
- **평소(28일)**: Phase 1로 안정적으로 운영 → 140달러
- **이벤트(2~4일)**: Phase 2로 트래픽 폭증 대응 → 21달러
- **합계**: 161달러 (115달러 절약, 42% 절감)

---

## 간단히 말하면

> "평소엔 안정적인 3-Tier로 운영하고,
> 블랙프라이데이 같은 이벤트 때는 서버리스로 전환해서
> 비용도 절약하고 트래픽도 무한대로 처리할 수 있게 만들었습니다."

---

## 사용법

### Phase 1 배포
```bash
cd phase1_ec2_rds
terraform init
terraform apply
```

### Phase 2 배포
```bash
terraform init
terraform apply
```

### 주의사항
- Lambda 함수 코드는 `lambda_functions/` 폴더에 있어야 함
- HTML 파일은 배포 후 S3에 수동으로 업로드하고 API URL 수정 필요

---

## 아키텍처 다이어그램
- Phase 1: 3-Tier 아키텍처 (첨부한 이미지 참고)
- Phase 2: 서버리스 아키텍처 (첨부한 이미지 참고)
